<!DOCTYPE html>
<html>
<head>
	<title>APCS Final Review</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
	
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
	<link type="text/css" rel="stylesheet" href="materialize/css/materialize.min.css"  media="screen"/>
	<link rel="stylesheet" href="styles.css">
</head>
<body>

	<ul id='lessonDropdown' class='dropdown-content' id="dropdown-content">
		<li class="link-lesson" id="link-lesson-1"><a href="#!">One</a></li>
		<li class="link-lesson" id="link-lesson-2"><a href="#!">Two</a></li>
		<li class="link-lesson" id="link-lesson-3"><a href="#!">Three</a></li>
		<li class="link-lesson" id="link-lesson-4"><a href="#!">Four</a></li>
		<li class="link-lesson" id="link-lesson-5"><a href="#!">Five</a></li>
		<li class="link-lesson" id="link-lesson-6"><a href="#!">Six</a></li>
		<li class="link-lesson" id="link-lesson-7"><a href="#!">Seven</a></li>
		<li class="link-lesson" id="link-lesson-8"><a href="#!">Eight</a></li>
		<li class="link-lesson" id="link-lesson-9"><a href="#!">Nine</a></li>
	</ul>
	<nav class="blue darken-2" style="position:fixed">
		<div class="nav-wrapper">
			<div class="col s12">
				<a href="#!" class="brand-logo" style="margin-left:30px;text-decoration:none">APCS Final Review</a>
				<ul class="right side-nav" style="margin-left:30px">
					<li style="margin-right:40px"><a class="dropdown-button" href="#" data-activates='lessonDropdown'><span style="position:relative; top:-8px;left:-3px">Lesson <span id="lessonNum">One</span></span><i class="mdi-navigation-arrow-drop-down right"></i></a></li>
				</ul>
			</div>
		</div>
	</nav>
	<div class="row">
		<div class="col l2 sidebar" id="scrollbar">
			<h3 style="margin-top:100px">Problems</h3>
			<div class="panels">

			</div>
		</div>

		<div class="col s9 content" id="scrollbar">
			<div class="container content-container">

			</div>
		</div>
	</div>

	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="materialize/js/materialize.min.js"></script>
	<script type="text/javascript" src="https://code.jquery.com/ui/1.10.4/jquery-ui.min.js"></script>
	<script type="text/javascript" src="jquery.nicescroll.min.js"></script>
	<script src="https://cdn.firebase.com/js/client/2.0.6/firebase.js"></script>

	<script type="text/javascript">
		var newContent;

		function initSetSetup(){
			var ref = new Firebase("https://apcsfinalreview.firebaseio.com/");
			var panels_content = "";
				var counter = 1;

				ref.child("1").on("value", function(snapshot) {
					console.log(snapshot.numChildren());
					snapshot.forEach(function(childSnapshot){
				  		panels_content+= '<div class="card-panel grey waves-effect waves-light text-center darken-3 set-panel" id="set-'+counter+'" style="margin-left:5px"><span class="white-text" style="font-size:24px;" id="set-title">Set '+counter+'</span></div>';
				  		if(counter >= snapshot.numChildren()){
							$(".panels").html(panels_content);
						}
						$(".set-panel").click(function(){
							set = parseInt($(this).attr('id').replace(/set-/,""));
							reload(1,set);
						});
						counter++;
					});
				});
		}

		function reload(lesson,set){
			var ref = new Firebase("https://apcsfinalreview.firebaseio.com/");
			var newRef = new Firebase("https://apcsfinalreview.firebaseio.com/"+lesson+"/"+set);
			newRef.once("value",function(basedSnapshot){
				newContent = '<div style="margin-top:50px;padding-bottom:30px;"><h2 class="header-text" style="padding-bottom:30px;padding-top:30px;display:inline">Set ' + set+ ' </h2><h5 style="display:inline;color:#bdbdbd">by '+basedSnapshot.child("name").val() + '</h5></div>';



				newRef.child('problems').on("value", function(snapshot) {
			  var counter = 1;
			  var loopCount = 1;
			  
			  snapshot.forEach(function(childSnapshot){
			  	var build = '<div class=problem><div class=title><h5 class="header-text subheader">Problem ' + counter + '</h5></div><br><br><br><p class=problem-text>'+childSnapshot.child(0).val()+'</p><br><br><a class="waves-effect waves-light btn answer-show" id="answer-'+counter+'" style=text-decoration:none>Show Answer</a><br><pre id="pre-'+counter+'" style=display:none>'+childSnapshot.child(1).val()+'</pre></div>';

			  	newContent = newContent + build;
				counter++;
				if(loopCount >= snapshot.numChildren()){
					$(".content-container").html(newContent);
					

					$(".answer-show").click(function() {
						console.log("here");
						var counter = $(this).attr('id').replace(/answer-/,"");
						console.log("here");
				        $('#pre-'+counter).slideToggle("fast");
				        console.log('#pre-'+counter);
				    });

				    console.log("yo");

					return true;
				}

				loopCount++;
			  })
			}, function (errorObject) {
			  console.log("The read failed: " + errorObject.code);
			});


			});
			

	

			
		}

		$(document).ready(function(){
			reload(1,1);
			initSetSetup();
			var ref = new Firebase("https://apcsfinalreview.firebaseio.com/");
			var lesson = 1;
			var set = 1;
			$(".link-lesson").click(function(){
				lesson = parseInt($(this).attr('id').replace(/link-lesson-/,""));
				var numInWords = ["One",'Two','Three','Four','Five','Six','Seven','Eight','Nine']
				$("#lessonNum").html(numInWords[lesson-1]);
				reload(lesson,1);
				var panels_content = "";
				var counter = 1;

				ref.child(""+lesson).on("value", function(snapshot) {
					console.log(snapshot.numChildren());
					snapshot.forEach(function(childSnapshot){
				  		panels_content+= '<div class="card-panel grey waves-effect waves-light text-center darken-3 set-panel" id="set-'+counter+'" style="margin-left:5px"><span class="white-text" style="font-size:24px;" id="set-title">Set '+counter+'</span></div>';
				  		if(counter >= snapshot.numChildren()){
							$(".panels").html(panels_content);
						}
						$(".set-panel").click(function(){
							set = parseInt($(this).attr('id').replace(/set-/,""));
							console.log("hello");
							reload(lesson,set);
						});

						counter++;
					});
				});

			});

			$('.dropdown-button').dropdown();


		});
	</script> 
</body>
</html>